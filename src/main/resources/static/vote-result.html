<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <h2>투표 결과</h2>
  <div id="vote-title"></div>
  <div id="vote-items-result"></div>
  <button onclick="location.href='vote-list.html'">← 목록으로</button>

  <script>
    const params = new URLSearchParams(location.search);
    const voteId = params.get("id");
    const token = localStorage.getItem("accessToken");

    fetch(`http://localhost:8080/api/votes/${voteId}`, {
      headers: {
        "Authorization": "Bearer " + token
      }
    })
            .then(res => res.json())
            .then(async vote => {
              document.getElementById("vote-title").innerText = "투표 제목: " + vote.title;

              const container = document.getElementById("vote-items-result");
              for (const item of vote.items) {
                const countRes = await fetch(`http://localhost:8080/api/votes/${voteId}/items/${item.itemId}/count`, {
                  headers: {
                    "Authorization": "Bearer " + token
                  }
                });
                const count = await countRes.text();

                const div = document.createElement("div");
                div.innerText = `${item.itemText}: ${count}표`;
                container.appendChild(div);
              }
            });
  </script>

</head>
<body>

</body>
</html>